"use strict";function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_createClass=function(){function t(t,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(a,e,n){return e&&t(a.prototype,e),n&&t(a,n),a}}();!function(t){var a=function(a){var e={val:"0",isAnyString:!1},n=[],i=0;if("number"==typeof a&&(a+=""),"string"==typeof a)if(n=a.split("").filter(function(a,n){return!!t.isNumeric(a)||(e.isAnyString=!0,!1)}),n.length)e.val=n.join("");else{for(var r=0;r<a.length;r++)i+=a.charCodeAt(r);e.val=i+"",e.isAnyString=!1}return e},e=function(a){var e=[];return t.each(a,function(t,a){a.unshift(t),e.push(a)}),e},n=function(){function n(a,e){_classCallCheck(this,n),this.options=e,this.$el=t(a),this.$el_=this.$el.clone(),this.bufferData=[],this.pageData=[],this.currentPage=1,this.initTable()}return _createClass(n,[{key:"initTable",value:function(){var t=e(this.options.data);this.options.data=t,this.bufferData=t,this.$el.wrap('<div class="simpleTable" />'),this.$el.append("<tbody></tbody>"),this.updateTable("init"),this.options.pagination?this.initPagination():this.pageData=t,this.options.search&&this.initSearch(),this.options.sort&&this.initSort(),this.updateTable()}},{key:"updateTable",value:function(){var t=this.$el.find("tbody"),a=this.pageData,e=[];if(t.children().detach(),a.length){var n=!0,i=!1,r=void 0;try{for(var s,o=a[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var p=s.value;e.push('<tr data-rowid="'+p[0]+'">');for(var u=1;u<p.length;u++)e.push("<td>"+p[u]+"</td>");e.push("</tr>")}}catch(d){i=!0,r=d}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw r}}}t.append(e.join(""))}},{key:"initSearch",value:function(){var a=this;a.$el.find("tbody");t('<input type="text" class="stSearch" placeholder="搜索"></input>').insertBefore(this.$el),a.$el.parent().find("input").on("keyup",function(){var e=t(this).val();a.bufferData=[];var n=!0,i=!1,r=void 0;try{for(var s,o=a.options.data[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)for(var p=s.value,u=1;u<p.length;u++)if((""+p[u]).toLowerCase().indexOf(e)>=0){a.bufferData.push(p);break}}catch(d){i=!0,r=d}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw r}}a.updatePagination(),a.updatePageNumber(),a.updateTable()})}},{key:"initPagination",value:function(){t('<div class="pagination"></div>').insertAfter(this.$el),this.$el.parent().find(".pagination").append('\n                <span>\n                    <a href="javascript: void(0);" class="stfront" data-stfront="0">&lt;</a>\n                        <span class="pageNumber"></span>\n                    <a href="javascript: void(0);" class="stback" data-stback="2">&gt;</a>\n                </span>\n                '),this.updatePagination(),this.updatePageNumber(),this.onPagination()}},{key:"updatePagination",value:function(){if(!this.options.pagination)return void(this.pageData=this.bufferData);var t=this.bufferData,a=this.options.pageOptions.pageItems,e=Math.ceil(t.length/a),n=(this.currentPage-1)*a,i=this.currentPage===e?t.length:n+a;if(this.pageData=[],t.length)for(var r=n;r<i;r++)this.pageData.push(t[r])}},{key:"updatePageNumber",value:function(){if(this.options.pagination){var t=Math.ceil(this.bufferData.length/this.options.pageOptions.pageItems),a=this.$el.parent().find(".pagination .pageNumber"),e=[],n=this.currentPage;a.children().detach();for(var i=0;i<t;i++)e.push('<a href="javascript: void(0);" class="'+(n===i+1?"active":"")+'" data-stpage="'+(i+1)+'">'+(i+1)+"</a>");a.append(e.join(""))}}},{key:"onPagination",value:function(){var a=this.$el.parent().find(".pagination"),e=this;a.find("[data-stfront]").on("click",function(){e.currentPage>1&&(a.find('[data-stpage="'+e.currentPage+'"]').removeClass("active"),e.currentPage-=1,a.find('[data-stpage="'+e.currentPage+'"]').addClass("active"),t(this).attr("data-stfront",e.currentPage-1),a.find("[data-stback]").attr("data-stback",e.currentPage+1),e.updatePagination(),e.updateTable())}),a.find("[data-stback]").on("click",function(){var n=parseInt(t(this).attr("data-stback")),i=Math.ceil(e.bufferData.length/e.options.pageOptions.pageItems);n<=i&&(a.find('[data-stpage="'+e.currentPage+'"]').removeClass("active"),e.currentPage+=1,a.find('[data-stpage="'+e.currentPage+'"]').addClass("active"),a.find("[data-stfront]").attr("data-stfront",e.currentPage-1),t(this).attr("data-stback",e.currentPage+1),e.updatePagination(),e.updateTable())}),a.on("click","[data-stpage]",function(){a.find('[data-stpage="'+e.currentPage+'"]').removeClass("active"),e.currentPage=parseInt(t(this).attr("data-stpage")),a.find('[data-stpage="'+e.currentPage+'"]').addClass("active"),a.find("[data-stfront]").attr("data-stfront",e.currentPage-1),a.find("[data-stback]").attr("data-stfront",e.currentPage+1),e.updatePagination(),e.updateTable()})}},{key:"initSort",value:function(){for(var e=this.$el.find("thead"),n=e.find("th"),i=(this.options.data,this.options.sortIcons),r=(i[0].split(" ")[0],i[0].split(" ")[1]),s=i[1].split(" ")[1],o=this.options.sortRows,p=this,u=0;u<n.length;u++)(o[u]||"undefined"==typeof o[u])&&(t(n[u]).attr("data-sort",u+1),t(n[u]).attr("data-sorttype","desc"),t(n[u]).append('&nbsp<i class="'+i[0]+'"></i>'));e.on("click","[data-sort]",function(){var e=t(this).attr("data-sort"),n=t(this).attr("data-sorttype"),i=t(this);i.find(".fa").removeClass("desc"===n?r:s),i.attr("data-sorttype","desc"===n?"asc":"desc"),i.find(".fa").addClass("desc"===n?s:r),p.bufferData.sort(function(t,i){var r=a(t[e]),s=a(i[e]),o=r.val.length>s.val.length?r.val.length:s.val.length,p=0;if(r.isAnyString||s.isAnyString)for(var u=0;u<o;u++){if(parseInt(r.val[u])>parseInt(s.val[u])){p=1;break}if(parseInt(r.val[u])<parseInt(s.val[u])){p=-1;break}}else p=parseInt(r.val)-parseInt(s.val);return p="desc"===n?p:-p}),p.updatePagination(),p.updateTable()})}},{key:"append",value:function(t){t.unshift(this.options.data.length),this.options.data.unshift(t),this.updatePagination(),this.updatePageNumber(),this.updateTable()}},{key:"remove",value:function(a){var e=this,n=parseInt(a.attr("data-rowid"));t.each(this.options.data,function(t,a){if(a[0]===n)return e.options.data.splice(t,1),!1}),this.updatePagination(),this.updatePageNumber(),this.updateTable()}},{key:"update",value:function(a){var e=this,n=parseInt(a[0].attr("data-rowid"));t.each(this.options.data,function(t,i){if(i[0]===n)return e.options.data[t]=a[1],e.options.data[t].unshift(n),!1}),this.updatePagination(),this.updateTable()}},{key:"reload",value:function(t){var a=e(t);this.options.data=a,this.bufferData=a,this.updatePagination(),this.updatePageNumber(),this.updateTable()}}]),n}();n.DEFAULTS={pagination:!0,sort:!0,search:!0,data:[],pageOptions:{pageItems:10},sortRows:[]};var i=["append","remove","update","reload"];t.fn.simpleTable=function(){for(var a=this,e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];this.each(function(){var e=t(a),s=e.data("simpleTable"),o=t.extend({},n.DEFAULTS,e.data(),"object"===_typeof(r[0])&&r[0]);if("string"==typeof r[0]){if(t.inArray(r[0],i)<0)throw new Error("Unknow method: "+r[0]);if(!s)return;switch(r[0]){case"append":s.append(r[1]);break;case"remove":s.remove(r[1]);break;case"update":r.shift(),s.update(r);break;case"reload":s.reload(r[1])}}s||e.data("simpleTable",s=new n(a,o))})}}(jQuery);